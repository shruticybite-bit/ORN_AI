import{r,j as s,a as l,b as x}from"./index-4f69de9b.js";const v="#",L="#",z=()=>{const[w,C]=r.useState([]),[a,f]=r.useState(null),[b,i]=r.useState(""),[B,c]=r.useState(""),[d,n]=r.useState(""),[u,m]=r.useState(null),[E,S]=r.useState(!0),[A,k]=r.useState(!1),[I,U]=r.useState(!1),[h,o]=r.useState(""),y=(e=>{const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null})("access"),p=e=>e?e.startsWith("http")?e:`${L}${e}`:"",N=async()=>{var e;S(!0),o("");try{const t=await x.get(v,{headers:{Authorization:`Bearer ${y}`}});C(t.data.results||t.data||[])}catch(t){console.error("Error loading blogs:",t),((e=t.response)==null?void 0:e.status)===403?o("You do not have permission to view blogs. Admin access required."):o("Failed to load blogs.")}finally{S(!1)}},$=e=>{f(e),i(e.title||""),c(e.description||""),e.imageUrl?n(e.imageUrl):n(e.image||""),m(null),o("")},j=async()=>{var e;if(!b.trim()){alert("Title is required");return}k(!0),o("");try{const t=new FormData;t.append("title",b),t.append("description",B),u&&t.append("image",u),d&&t.append("imageUrl",d);const g={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y}`}};a?await x.put(`${v}${a.blogId}/`,t,g):await x.post(v,t,g),i(""),c(""),n(""),m(null),f(null),N()}catch(t){console.error(t),((e=t.response)==null?void 0:e.status)===403?o("You do not have permission to save blogs. Admin access required."):o("Failed to save blog.")}finally{k(!1)}},D=async()=>{var e;if(a&&window.confirm("Are you sure you want to delete this blog?")){U(!0),o("");try{await x.delete(`${v}${a.blogId}/`,{headers:{Authorization:`Bearer ${y}`}}),f(null),i(""),c(""),n(""),m(null),N()}catch(t){console.error(t),((e=t.response)==null?void 0:e.status)===403?o("You do not have permission to delete blogs. Admin access required."):o("Failed to delete blog.")}finally{U(!1)}}};return r.useEffect(()=>{N()},[]),s("div",{className:"flex flex-col md:flex-row h-[85vh] bg-gray-100 rounded-lg shadow-md overflow-hidden",children:[s("div",{className:"w-full md:w-1/3 border-r border-gray-200 bg-white flex flex-col",children:[l("div",{className:"p-4 font-semibold text-lg border-b bg-blue-50 text-blue-700",children:"ðŸ“ Blog Management"}),E?l("div",{className:"p-4 text-center text-gray-500",children:"Loading blogs..."}):h?l("div",{className:"p-4 text-center text-red-500 font-medium",children:h}):w.length===0?l("div",{className:"p-4 text-center text-gray-400",children:"No blogs found"}):l("div",{className:"flex-1 overflow-y-auto",children:w.map(e=>{var g;const t=p(e.image)?p(e.image):p(e.imageUrl);return s("div",{className:`p-3 cursor-pointer border-b hover:bg-blue-50 transition flex items-center gap-3 ${(a==null?void 0:a.blogId)===e.blogId?"bg-blue-100":""}`,onClick:()=>$(e),children:[l("div",{className:"w-14 h-14 flex-shrink-0 rounded overflow-hidden bg-gray-100 border",children:t?l("img",{src:t,alt:e.title,className:"w-full h-full object-cover",onError:F=>F.target.style.display="none"}):l("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"No Image"})}),s("div",{className:"flex-1",children:[l("div",{className:"font-medium text-gray-800",children:e.title}),s("div",{className:"text-sm text-gray-500 truncate",children:[(g=e.description)==null?void 0:g.replace(/<[^>]*>?/gm,"").substring(0,50),"..."]})]})]},e.blogId)})}),l("button",{onClick:()=>{f(null),i(""),c(""),n(""),m(null)},className:"m-4 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg",children:"+ Add New Blog"})]}),s("div",{className:"flex-1 flex flex-col bg-gray-50",children:[s("div",{className:"p-4 border-b bg-white flex justify-between items-center",children:[l("div",{className:"font-semibold text-gray-800",children:a?"Edit Blog":"New Blog"}),a&&l("button",{onClick:D,disabled:I,className:"text-sm text-red-500 hover:underline",children:I?"Deleting...":"Delete"})]}),s("div",{className:"flex-1 overflow-y-auto p-4",children:[h&&l("div",{className:"mb-4 text-red-500 font-medium",children:h}),s("div",{className:"mb-4",children:[l("label",{className:"block mb-1 font-medium text-gray-700",children:"Title"}),l("input",{type:"text",value:b,onChange:e=>i(e.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s("div",{className:"mb-4",children:[l("label",{className:"block mb-1 font-medium text-gray-700",children:"Description"}),l("textarea",{value:B,onChange:e=>c(e.target.value),rows:8,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),s("div",{className:"mb-4",children:[l("label",{className:"block mb-1 font-medium text-gray-700",children:"Image Upload"}),l("input",{type:"file",accept:"image/*",onChange:e=>m(e.target.files[0]),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),u&&l("img",{src:URL.createObjectURL(u),alt:"Preview",className:"mt-2 w-32 h-20 object-cover rounded"})]}),s("div",{className:"mb-4",children:[l("label",{className:"block mb-1 font-medium text-gray-700",children:"Or Image URL"}),l("input",{type:"text",value:d,onChange:e=>n(e.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),!u&&d&&l("img",{src:p(d),alt:"Blog",className:"mt-2 w-32 h-20 object-cover rounded"})]}),l("button",{onClick:j,disabled:A||!b.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:A?"Saving...":a?"Update Blog":"Add Blog"})]})]})]})};export{z as default};
