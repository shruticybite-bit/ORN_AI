import{c as R,i as P,u as $,r as i,s as T,j as a,F as U,a as e,a0 as l,L as C,k as D,y as d,b as I}from"./index-365972c4.js";import{I as B}from"./IconMail-f7b9ff74.js";import{I as M}from"./IconLockDots-312cd0d7.js";import{N as A,F as O}from"./Footer-c50aecf8.js";import"./createLucideIcon-9e7f1bc4.js";const H=()=>{const x=R(),_=P();$(s=>s.themeConfig);const[m,L]=i.useState(""),[u,j]=i.useState(""),[b,p]=i.useState(!1),[y,w]=i.useState(""),[v,h]=i.useState(!1),[f,k]=i.useState(""),[g,N]=i.useState(!1);i.useEffect(()=>{x(T("Login Boxed"))},[x]);const E=async s=>{var c,o;if(s.preventDefault(),w(""),p(!0),!m.trim()||!u.trim()){d.error("Please fill in all fields.",{position:"top-center"}),p(!1);return}try{const t=(await I.post("#",{username:m,password:u},{headers:{"Content-Type":"application/json"},withCredentials:!0})).data;t.user&&(document.cookie=`username=${encodeURIComponent(t.user.username)}; path=/; max-age=86400`,document.cookie=`user_id=${encodeURIComponent(t.user.id)}; path=/; max-age=86400`,document.cookie=`email=${encodeURIComponent(t.user.email)}; path=/; max-age=86400`,document.cookie=`is_staff=${t.user.is_staff}; path=/; max-age=86400`,document.cookie=`access=${t.access}; path=/; max-age=86400`,localStorage.setItem("jwt-auth",t.access),localStorage.setItem("userId",t.user.id),localStorage.setItem("email",t.user.email),localStorage.setItem("username",t.user.username),d.success("Login successful!",{position:"top-center"}),console.log("data=",t,"user=",t.user),setTimeout(()=>{Number(t.user.id)===1?_("/index"):window.location.href="/"},1200))}catch(n){let t="Invalid username or password.";if((c=n.response)!=null&&c.data){const r=n.response.data;if(r.non_field_errors&&((o=r.non_field_errors[0])!=null&&o.includes("verify your email")))t=a("span",{children:[r.non_field_errors[0]," ",e(C,{to:"/otp",className:"text-blue-500 underline",children:"Verify OTP"})]});else if(r.detail)t=r.detail;else if(r.error)t=r.error;else if(typeof r=="object"){const S=Object.keys(r)[0];Array.isArray(r[S])&&(t=r[S][0])}}w(t),d.error(t,{position:"top-center",autoClose:4e3})}finally{p(!1)}},F=async()=>{var s;if(!f.trim()){d.error("Please enter your email address.",{position:"top-center"});return}N(!0);try{const o=(await I.post("#",{email:f},{headers:{"Content-Type":"application/json"}})).data.detail||"Reset link sent successfully!";d.success(o,{position:"top-center"}),k(""),h(!1)}catch(c){let o="Something went wrong!";if((s=c.response)!=null&&s.data){const n=c.response.data;n.email?o=n.email[0]:n.detail&&(o=n.detail)}d.error(o,{position:"top-center"})}finally{N(!1)}};return a(U,{children:[e(A,{}),a("div",{children:[e("div",{className:"absolute inset-0",children:e("img",{src:"/assets/images/auth/bg-gradient.png",alt:"background",className:"h-full w-full object-cover"})}),e("div",{className:"relative flex min-h-screen items-center justify-center bg-[url(/assets/images/auth/map.png)] bg-cover bg-center px-6 py-10 dark:bg-[#060818] sm:px-16",children:e("div",{className:"relative w-full max-w-[870px] rounded-md bg-white/60 dark:bg-black/50 p-2 backdrop-blur-lg shadow-lg",children:a("div",{className:"relative flex flex-col justify-center rounded-md bg-white/80 px-6 py-20 dark:bg-black/60",children:[a("div",{className:"mx-auto w-full max-w-[440px]",children:[a("div",{className:"mb-10 text-center",children:[e("h1",{className:"text-3xl font-extrabold uppercase text-primary md:text-4xl",children:l.t("Sign in")}),e("p",{className:"text-base font-bold text-white-dark",children:l.t("Enter your credentials to log in")})]}),!v&&a("form",{className:"space-y-5 dark:text-white",onSubmit:E,children:[a("div",{children:[e("label",{children:l.t("Username")}),a("div",{className:"relative text-white-dark",children:[e("input",{type:"text",placeholder:l.t("Enter username"),className:"form-input ps-10 placeholder:text-white-dark",value:m,onChange:s=>L(s.target.value)}),e("span",{className:"absolute start-4 top-1/2 -translate-y-1/2",children:e(B,{fill:!0})})]})]}),a("div",{children:[e("label",{children:l.t("Password")}),a("div",{className:"relative text-white-dark",children:[e("input",{type:"password",placeholder:l.t("Enter password"),className:"form-input ps-10 placeholder:text-white-dark",value:u,onChange:s=>j(s.target.value)}),e("span",{className:"absolute start-4 top-1/2 -translate-y-1/2",children:e(M,{fill:!0})})]})]}),y&&e("p",{className:"text-red-500 text-sm",children:y}),e("button",{type:"submit",disabled:b,className:"btn btn-gradient !mt-6 w-full uppercase shadow-[0_10px_20px_-10px_rgba(67,97,238,0.44)]",children:b?"Signing in...":"Sign in"}),e("p",{className:"text-primary text-center mt-3 cursor-pointer hover:underline",onClick:()=>h(!0),children:"Forgot Password?"})]}),v&&a("div",{className:"space-y-4",children:[e("input",{type:"email",placeholder:"Enter your email",className:"form-input w-full",value:f,onChange:s=>k(s.target.value)}),e("button",{type:"button",onClick:F,disabled:g,className:`btn btn-gradient w-full ${g?"opacity-60 cursor-not-allowed":""}`,children:g?"Sending...":"Send Reset Link"}),e("p",{className:"text-center text-primary cursor-pointer mt-2 hover:underline",onClick:()=>h(!1),children:"Back to Login"})]})]}),a("div",{className:"text-center mt-6 dark:text-white",children:[l.t("Don't have an account?")," ",e(C,{to:"/auth/boxed-signup",className:"uppercase text-primary underline transition hover:text-black dark:hover:text-white",children:l.t("Register here")})]})]})})}),e(D,{autoClose:2e3,theme:"colored"})]}),e(O,{})]})};export{H as default};
