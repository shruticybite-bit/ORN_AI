import{r as a,j as n,a as t,F as T,b}from"./index-437b21d3.js";const v="#",z=()=>{const[y,M]=a.useState([]),[l,p]=a.useState(null),[u,N]=a.useState([]),[o,w]=a.useState(""),[E,C]=a.useState(!0),[L,S]=a.useState(!1),[m,k]=a.useState(!1),g=a.useRef(null),_=a.useRef(null),c=a.useRef(null),$=a.useRef(null),A=a.useRef(null),h=(e=>{const s=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return s?s[2]:null})("access"),I=e=>JSON.stringify(e).length,f=async(e=!1)=>{e||C(!0);try{const s=await b.get(`${v}/chats/`,{headers:{Authorization:`Bearer ${h}`}}),r=s.data.results||s.data||[],i=I(r);i!==$.current&&(M(r),$.current=i)}catch(s){console.error("Chat list error:",s)}finally{e||C(!1)}},R=e=>{p(e),N([]),x(e.id),c.current&&clearInterval(c.current),c.current=setInterval(()=>x(e.id,!0),2e3)},x=async(e,s=!1)=>{if(e){s||S(!0);try{const r=await b.get(`${v}/chats/messages/?chat_id=${e}`,{headers:{Authorization:`Bearer ${h}`}}),i=r.data.results||r.data||[],d=I(i);d!==A.current&&(N(i),A.current=d)}catch(r){console.error("Messages load error:",r)}finally{s||S(!1)}}},j=async()=>{if(!(!o.trim()||!l)){k(!0);try{await b.post(`${v}/chats/messages/`,{chat_id:l.id,message:o},{headers:{Authorization:`Bearer ${h}`}}),w(""),await x(l.id,!0),await f(!0)}catch(e){console.error(e),alert("Failed to send message.")}finally{k(!1)}}};return a.useEffect(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth"})},[u]),a.useEffect(()=>(f(),_.current=setInterval(()=>f(!0),5e3),()=>{clearInterval(_.current),clearInterval(c.current)}),[]),n("div",{className:"flex flex-col md:flex-row h-[85vh] bg-gray-100 rounded-lg shadow-md overflow-hidden",children:[n("div",{className:"w-full md:w-1/3 border-r border-gray-200 bg-white flex flex-col",children:[t("div",{className:"p-4 font-semibold text-lg border-b bg-blue-50 text-blue-700",children:"ðŸ§‘â€ðŸ’» Admin Chat Panel"}),E?t("div",{className:"p-4 text-center text-gray-500",children:"Loading chats..."}):y.length===0?t("div",{className:"p-4 text-center text-gray-400",children:"No active chats"}):t("div",{className:"flex-1 overflow-y-auto",children:y.map(e=>{const s=e.userName||e.user_name||"User",r=e.last_message||"",i=e.unread_count||0,d=e.last_message_time?new Date(e.last_message_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return n("div",{className:`p-3 cursor-pointer border-b hover:bg-blue-50 transition ${(l==null?void 0:l.id)===e.id?"bg-blue-100":""}`,onClick:()=>R(e),children:[n("div",{className:"flex justify-between items-center",children:[t("span",{className:"font-medium text-gray-800",children:s}),t("span",{className:"text-xs text-gray-500",children:d})]}),t("div",{className:"text-sm text-gray-500 truncate",children:r}),i>0&&t("div",{className:"text-xs text-white bg-blue-600 rounded-full px-2 inline-block mt-1",children:i})]},e.id)})})]}),t("div",{className:"flex-1 flex flex-col bg-gray-50",children:l?n(T,{children:[n("div",{className:"p-4 border-b bg-white flex justify-between items-center",children:[n("div",{children:[t("div",{className:"font-semibold text-gray-800",children:l.userName||l.user_name||"User"}),n("div",{className:"text-xs text-gray-500",children:["Chat ID: ",l.id]})]}),t("button",{onClick:()=>{p(null),clearInterval(c.current)},className:"text-sm text-red-500 hover:underline",children:"Close"})]}),n("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-100",children:[L?t("div",{className:"text-center text-gray-500 mt-10",children:"Loading messages..."}):u.length===0?t("div",{className:"text-center text-gray-400 mt-10",children:"No messages yet."}):u.map((e,s)=>{const r=e.sender==="admin"||e.is_admin;return t("div",{className:`flex ${r?"justify-end":"justify-start"} mb-3`,children:n("div",{className:`p-3 rounded-lg shadow text-sm max-w-[70%] ${r?"bg-blue-500 text-white":"bg-white text-gray-800"}`,children:[t("div",{children:e.message}),n("div",{className:"text-[10px] mt-1 opacity-75 text-right",children:[r?"Admin":"User"," â€¢"," ",new Date(e.timestamp||e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})},e.id||s)}),t("div",{ref:g})]}),n("div",{className:"p-4 border-t bg-white flex items-center",children:[t("input",{type:"text",className:"flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Type a message...",value:o,disabled:m,onChange:e=>w(e.target.value),onKeyDown:e=>e.key==="Enter"&&j()}),t("button",{onClick:j,disabled:m||!o.trim(),className:"ml-3 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:m?"Sending...":"Send"})]})]}):n("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[t("div",{className:"text-5xl mb-4",children:"ðŸ’¬"}),t("div",{children:"Select a user chat to start messaging"})]})})]})};export{z as default};
