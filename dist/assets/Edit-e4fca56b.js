import{i as M,c as V,w as W,r as f,b as U,j as n,a,g as Y,L as K}from"./index-365972c4.js";import{I as X}from"./IconSave-25db6492.js";import{I as H}from"./IconEye-4d17240e.js";import{z as J}from"./index-2a736327.js";const ee=()=>{const T=M();V();const{id:b}=W(),P=["USD - US Dollar","GBP - British Pound","IDR - Indonesian Rupiah","INR - Indian Rupee","BRL - Brazilian Real","EUR - Germany (Euro)","TRY - Turkish Lira"],u={"USD - US Dollar":"$","GBP - British Pound":"£","IDR - Indonesian Rupiah":"Rp","INR - Indian Rupee":"₹","BRL - Brazilian Real":"R$","EUR - Germany (Euro)":"€","TRY - Turkish Lira":"₺"},[i,m]=f.useState({invoiceLabel:"",invoiceNo:"",invoiceDate:"",dueDate:"",notes:"",to:{name:"",email:"",address:"",phone:""},bankInfo:{accountNumber:"",bankName:"",swiftNumber:"",country:"",ibanNumber:""}}),[o,g]=f.useState([]),[v,w]=f.useState(0),[N,D]=f.useState(0),[y,k]=f.useState(0),[d,S]=f.useState("USD - US Dollar"),[x,$]=f.useState("bank");f.useEffect(()=>{b&&U.get(`https://cybitbackend.onrender.com/api/invoices/${b}`).then(t=>{var e,c,r,s,p,B,C,E,R,L;if(t.data.success&&t.data.invoice){const l=t.data.invoice;m({invoiceLabel:l.invoiceLabel||"",invoiceNo:l.invoiceNumber||"",invoiceDate:l.invoiceDate?l.invoiceDate.split("T")[0]:"",dueDate:l.dueDate?l.dueDate.split("T")[0]:"",notes:l.notes||"",to:{name:((e=l.billing)==null?void 0:e.name)||"",email:((c=l.billing)==null?void 0:c.email)||"",address:((r=l.billing)==null?void 0:r.address)||"",phone:((s=l.billing)==null?void 0:s.phone)||""},bankInfo:{accountNumber:((p=l.paymentDetails)==null?void 0:p.accountNumber)||"",bankName:((B=l.paymentDetails)==null?void 0:B.bankName)||"",swiftNumber:((C=l.paymentDetails)==null?void 0:C.swiftNumber)||"",country:((E=l.paymentDetails)==null?void 0:E.country)||"",ibanNumber:((R=l.paymentDetails)==null?void 0:R.ibanNumber)||""}}),g(((L=l.items)==null?void 0:L.map(z=>({...z,id:crypto.randomUUID()})))||[]),w(l.tax||0),D(l.discount||0),k(l.shippingCharge||0),S(l.currency||"USD - US Dollar")}}).catch(t=>console.error("Failed to fetch invoice",t))},[b]);const I=(t,e,c)=>{g(o.map(r=>r.id===t?{...r,[e]:c}:r))},j=()=>{g([...o,{id:crypto.randomUUID(),title:"",description:"",quantity:0,amount:0}])},F=t=>{g(o.filter(e=>e.id!==t))},q=()=>{if(!i.invoiceNo.trim()){const e=document.getElementById("number");return e==null||e.focus(),!1}if(!i.invoiceLabel.trim()){const e=document.getElementById("invoiceLabel");return e==null||e.focus(),!1}if(!i.invoiceDate.trim()){const e=document.getElementById("startDate");return e==null||e.focus(),!1}if(!i.dueDate.trim()){const e=document.getElementById("dueDate");return e==null||e.focus(),!1}if(!i.to.name.trim()){const e=document.getElementById("reciever-name");return e==null||e.focus(),!1}if(!i.to.email.trim()){const e=document.getElementById("reciever-email");return e==null||e.focus(),!1}if(!/\S+@\S+\.\S+/.test(i.to.email)){const e=document.getElementById("reciever-email");return e==null||e.focus(),!1}if(!i.to.address.trim()){const e=document.getElementById("reciever-address");return e==null||e.focus(),!1}if(!i.bankInfo.accountNumber.trim()){const e=document.getElementById("acno");return e==null||e.focus(),!1}if(!i.bankInfo.bankName.trim()){const e=document.getElementById("bank-name");return e==null||e.focus(),!1}if(!x){const e=document.getElementById("payment-method");return e==null||e.focus(),!1}if(!i.notes.trim()){const e=document.getElementById("notes");return e==null||e.focus(),!1}if(o.length===0){const e=document.getElementById("add-item-button");return e==null||e.focus(),!1}if(x==="bank"){if(!i.bankInfo.accountNumber.trim()){const e=document.getElementById("acno");return e==null||e.focus(),!1}if(!i.bankInfo.bankName.trim()){const e=document.getElementById("bank-name");return e==null||e.focus(),!1}if(!i.bankInfo.swiftNumber.trim()){const e=document.getElementById("swift-no");return e==null||e.focus(),!1}if(!i.bankInfo.ibanNumber.trim()){const e=document.getElementById("iban-no");return e==null||e.focus(),!1}if(!i.bankInfo.country.trim()){const e=document.querySelector("select");return e==null||e.focus(),!1}}for(let e=0;e<o.length;e++){const c=o[e],r=document.getElementById(`item-title-${c.id}`),s=document.getElementById(`item-qty-${c.id}`),p=document.getElementById(`item-price-${c.id}`);if(!c.title.trim())return r==null||r.focus(),!1;if(c.quantity<=0)return s==null||s.focus(),!1;if(c.amount<=0)return p==null||p.focus(),!1}return!0},A=()=>{if(!q()||!b)return;const t={invoiceLabel:i.invoiceLabel,invoiceNumber:i.invoiceNo,invoiceDate:i.invoiceDate,dueDate:i.dueDate,notes:i.notes,billing:i.to,paymentDetails:i.bankInfo,items:o,tax:v,discount:N,shippingCharge:y,currency:d,paymentMethod:x};U.put(`https://cybitbackend.onrender.com/api/invoices/${b}`,t).then(e=>{e.data.success?setTimeout(()=>{J.success("Invoice updated successfully"),T("/apps/invoice/list")},1e3):alert("Failed to update invoice!")}).catch(e=>{console.error("Update failed",e),alert("Error updating invoice. Check console.")})},h=o.reduce((t,e)=>t+e.amount*e.quantity,0),G=h+h*v/100+y-h*N/100;return n("div",{className:"flex xl:flex-row flex-col gap-2.5",children:[n("div",{className:"panel px-0 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6",children:[n("div",{className:"flex justify-between flex-wrap px-4",children:[n("div",{className:"mb-6 lg:w-1/2 w-full",children:[a("img",{src:"/assets/images/cybblackpink.png",alt:"logo",className:"w-14"}),n("div",{className:"space-y-1 mt-6 text-gray-500 dark:text-gray-400",children:[a("div",{children:"G-9/85,Sangam Vihar New Delhi-110080"}),a("div",{children:"info@cybite.in"}),a("div",{children:"+91 8210543772"})]})]}),a("div",{className:"lg:w-1/2 w-full lg:max-w-fit",children:["Invoice Number","Invoice Label","Invoice Date","Due Date"].map(t=>{const e=t.replace(/\s/g,"").toLowerCase(),c=t.includes("Date")?"date":"text",r=e==="invoicenumber"?i.invoiceNo:e==="invoicelabel"?i.invoiceLabel:e==="invoicedate"?i.invoiceDate:i.dueDate;return n("div",{className:"flex items-center mt-4",children:[a("label",{className:"flex-1 ltr:mr-2 rtl:ml-2 mb-0",children:t}),a("input",{id:e==="invoicenumber"?"number":e==="invoicelabel"?"invoiceLabel":e==="invoicedate"?"startDate":"dueDate",type:c,className:"form-input lg:w-[250px] w-2/3",value:r,onChange:s=>{m(e==="invoicenumber"?{...i,invoiceNo:s.target.value}:e==="invoicelabel"?{...i,invoiceLabel:s.target.value}:e==="invoicedate"?{...i,invoiceDate:s.target.value}:{...i,dueDate:s.target.value})}})]},t)})})]}),a("hr",{className:"border-white-light dark:border-[#1b2e4b] my-6"}),n("div",{className:"mt-8 px-4 flex flex-col lg:flex-row gap-6",children:[n("div",{className:"lg:w-1/2 w-full space-y-4",children:[a("div",{className:"text-lg",children:"Bill To :-"}),["name","email","address","phone"].map(t=>n("div",{className:"flex items-center",children:[a("label",{className:"ltr:mr-2 rtl:ml-2 w-1/3 mb-0",children:t.charAt(0).toUpperCase()+t.slice(1)}),a("input",{id:`reciever-${t}`,type:t==="email"?"email":"text",className:"form-input flex-1",placeholder:`Enter ${t}`,value:i.to[t],onChange:e=>m({...i,to:{...i.to,[t]:e.target.value}})})]},t))]}),n("div",{className:"lg:w-1/2 w-full space-y-4",children:[a("div",{className:"text-lg",children:"Payment Details:"}),[{label:"Account Number",field:"accountNumber"},{label:"Bank Name",field:"bankName"},{label:"SWIFT Number",field:"swiftNumber"},{label:"IBAN Number",field:"ibanNumber"}].map(t=>n("div",{className:"flex items-center",children:[a("label",{className:"ltr:mr-2 rtl:ml-2 w-1/3 mb-0",children:t.label}),a("input",{id:t.field==="accountNumber"?"acno":t.field==="bankName"?"bank-name":t.field==="swiftNumber"?"swift-no":"iban-no",type:"text",className:"form-input flex-1",value:i.bankInfo[t.field],onChange:e=>m({...i,bankInfo:{...i.bankInfo,[t.field]:e.target.value}})})]},t.field)),n("div",{className:"flex items-center",children:[a("label",{className:"ltr:mr-2 rtl:ml-2 w-1/3 mb-0",children:"Country"}),n("select",{className:"form-select flex-1",value:i.bankInfo.country,onChange:t=>m({...i,bankInfo:{...i.bankInfo,country:t.target.value}}),children:[a("option",{value:"",children:"Choose Country"}),["United States","United Kingdom","Canada","Australia","Germany","India"].map(t=>a("option",{value:t,children:t},t))]})]})]})]}),n("div",{className:"mt-8 px-4",children:[a("div",{className:"table-responsive",children:n("table",{children:[a("thead",{children:n("tr",{children:[a("th",{children:"Item"}),a("th",{className:"w-1",children:"Quantity"}),a("th",{className:"w-1",children:"Price"}),a("th",{children:"Total"}),a("th",{className:"w-1"})]})}),n("tbody",{children:[o.length===0&&a("tr",{children:a("td",{colSpan:5,className:"text-center font-semibold",children:"No Item Available"})}),o.map(t=>n("tr",{className:"align-top",children:[n("td",{children:[a("input",{id:`item-title-${t.id}`,type:"text",className:"form-input min-w-[200px]",placeholder:"Enter Item Name",value:t.title,onChange:e=>I(t.id,"title",e.target.value)}),a("textarea",{className:"form-textarea mt-4",placeholder:"Enter Description",value:t.description,onChange:e=>I(t.id,"description",e.target.value)})]}),a("td",{children:a("input",{id:`item-qty-${t.id}`,type:"number",className:"form-input w-32",min:0,value:t.quantity,onChange:e=>I(t.id,"quantity",Number(e.target.value))})}),a("td",{children:a("input",{id:`item-price-${t.id}`,type:"number",className:"form-input w-32",min:0,value:t.amount,onChange:e=>I(t.id,"amount",Number(e.target.value))})}),n("td",{children:[u[d],(t.quantity*t.amount).toFixed(2)]}),a("td",{children:a("button",{type:"button",onClick:()=>F(t.id),children:a(Y,{className:"w-5 h-5"})})})]},t.id))]})]})}),n("div",{className:"flex justify-between sm:flex-row flex-col mt-6 px-4",children:[a("button",{id:"add-item-button",type:"button",className:"btn btn-primary",style:{fontSize:"0.875rem",height:"116%",minWidth:"auto"},onClick:j,children:"Add Item"}),n("div",{className:"sm:w-2/5 space-y-2",children:[n("div",{className:"flex justify-between",children:["Subtotal ",n("span",{children:[u[d],h.toFixed(2)]})]}),n("div",{className:"flex justify-between",children:["Tax(",v,"%) ",n("span",{children:[u[d],(h*v/100).toFixed(2)]})]}),n("div",{className:"flex justify-between",children:["Shipping Rate(",u[d],")",n("span",{children:[u[d],y.toFixed(2)]})]}),n("div",{className:"flex justify-between",children:["Discount(",N,"%)",n("span",{children:[u[d],(h*N/100).toFixed(2)]})]}),n("div",{className:"flex justify-between font-semibold",children:["Total",n("span",{children:[u[d],G.toFixed(2)]})]})]})]})]}),n("div",{className:"mt-8 px-4",children:[a("label",{children:"Notes"}),a("textarea",{className:"form-textarea min-h-[130px]",placeholder:"Notes...",value:i.notes,onChange:t=>m({...i,notes:t.target.value})})]})]}),n("div",{className:"xl:w-96 w-full xl:mt-0 mt-6",children:[n("div",{className:"panel mb-5",children:[a("label",{children:"Currency"}),a("select",{className:"form-select",value:d,onChange:t=>S(t.target.value),children:P.map(t=>a("option",{value:t,children:t},t))}),n("div",{className:"mt-4 grid sm:grid-cols-2 grid-cols-1 gap-4",children:[n("div",{children:[a("label",{children:"Tax(%)"}),a("input",{type:"number",className:"form-input",value:v,onChange:t=>w(Number(t.target.value))})]}),n("div",{children:[a("label",{children:"Discount(%)"}),a("input",{type:"number",className:"form-input",value:N,onChange:t=>D(Number(t.target.value))})]})]}),n("div",{className:"mt-4",children:[n("label",{children:["Shipping Charge(",u[d],")"]}),a("input",{type:"number",className:"form-input",value:y,onChange:t=>k(Number(t.target.value))})]}),n("div",{className:"mt-4",children:[a("label",{children:"Accept Payment Via"}),n("select",{className:"form-select",value:x,onChange:t=>$(t.target.value),children:[a("option",{value:"",children:"Select Payment"}),a("option",{value:"bank",children:"Bank Account"}),a("option",{value:"paypal",children:"Paypal"}),a("option",{value:"upi",children:"UPI Transfer"})]})]})]}),n("div",{className:"panel grid xl:grid-cols-1 lg:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-4",children:[n("button",{className:"btn btn-success w-full gap-2",onClick:A,children:[a(X,{})," Save"]}),n(K,{to:`/apps/invoice/preview/${b}`,className:"btn btn-primary w-full gap-2",children:[a(H,{})," Preview"]})]})]})]})};export{ee as default};
