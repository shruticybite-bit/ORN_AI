import{r as i,j as o,a as t,b as p}from"./index-ddd0bdee.js";import{h as j}from"./html2pdf-1c95f139.js";import{S as u}from"./sweetalert2.all-d1d5bc03.js";const v="#",w=5,R=()=>{const[f,C]=i.useState([]),[h,x]=i.useState([]),[S,y]=i.useState(!1),[c,U]=i.useState(""),[l,g]=i.useState(1),d=(e=>{const r=`; ${document.cookie}`.split(`; ${e}=`);if(r.length===2)return r.pop().split(";").shift()})("access"),L=async()=>{y(!0);try{const n=(await p.get(v,{headers:d?{Authorization:`Bearer ${d}`}:{},withCredentials:!0})).data.results||[];C(n),x(n)}catch(e){console.error("Error fetching users:",e)}finally{y(!1)}};i.useEffect(()=>{L()},[]),i.useEffect(()=>{const e=f.filter(n=>{var r,a,s,$;return((r=n.username)==null?void 0:r.toLowerCase().includes(c.toLowerCase()))||((a=n.email)==null?void 0:a.toLowerCase().includes(c.toLowerCase()))||((s=n.first_name)==null?void 0:s.toLowerCase().includes(c.toLowerCase()))||(($=n.last_name)==null?void 0:$.toLowerCase().includes(c.toLowerCase()))});x(e),g(1)},[c,f]);const m=Math.ceil(h.length/w),N=l*w,A=N-w,_=h.slice(A,N),b=e=>{e<1||e>m||g(e)},D=async e=>{if((await u.fire({title:"Are you sure?",text:"This user will be permanently deleted!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{await p.delete(`${v}${e.id}/`,{headers:d?{Authorization:`Bearer ${d}`}:{},withCredentials:!0});const r=f.filter(a=>a.id!==e.id);C(r),u.fire({icon:"success",toast:!0,position:"top",title:"User deleted!",showConfirmButton:!1,timer:2e3})}catch(r){console.error("Delete failed:",r),u.fire({icon:"error",toast:!0,position:"top",title:"Failed to delete user",showConfirmButton:!1,timer:2e3})}},E=async e=>{try{await p.patch(`${v}${e.id}/`,{is_active:!e.is_active},{headers:d?{Authorization:`Bearer ${d}`}:{},withCredentials:!0}),L()}catch(n){console.error("Toggle failed:",n)}};return o("div",{children:[o("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-3",children:[t("input",{type:"text",placeholder:"Search users...",className:"form-input py-2 px-3 border rounded",value:c,onChange:e=>U(e.target.value)}),o("div",{className:"flex gap-2",children:[t("button",{className:"btn btn-sm btn-primary",onClick:()=>{let n=["ID","Username","Email","First Name","Last Name","Date Joined","Active"].join(",")+`
`;h.forEach(s=>{n+=[s.id,s.username,s.email,s.first_name||"-",s.last_name||"-",new Date(s.date_joined).toLocaleString(),s.is_active?"Active":"Inactive"].join(",")+`
`});const r=new Blob([n],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(r),a.download="UsersList.csv",a.click()},children:"Export CSV"}),t("button",{className:"btn btn-sm btn-primary",onClick:()=>{const e=document.createElement("table");e.innerHTML=`
      <thead>
        <tr>
          <th>ID</th><th>Username</th><th>Email</th><th>First Name</th><th>Last Name</th><th>Date Joined</th><th>Active</th>
        </tr>
      </thead>
      <tbody>
        ${h.map(n=>`<tr>
              <td>${n.id}</td>
              <td>${n.username}</td>
              <td>${n.email}</td>
              <td>${n.first_name||"-"}</td>
              <td>${n.last_name||"-"}</td>
              <td>${new Date(n.date_joined).toLocaleString()}</td>
              <td>${n.is_active?"Active":"Inactive"}</td>
            </tr>`).join("")}
      </tbody>
    `,j().set({margin:10,filename:"UsersList.pdf",html2canvas:{scale:2},jsPDF:{unit:"pt",format:"a4",orientation:"landscape"}}).from(e).save()},children:"Export PDF"})]})]}),t("div",{className:"overflow-x-auto",children:o("table",{className:"table table-striped table-hover w-full",children:[t("thead",{children:o("tr",{children:[t("th",{children:"ID"}),t("th",{children:"Username"}),t("th",{children:"Email"}),t("th",{children:"First Name"}),t("th",{children:"Last Name"}),t("th",{children:"Date Joined"}),t("th",{children:"Active"}),t("th",{children:"Actions"})]})}),t("tbody",{children:S?t("tr",{children:t("td",{colSpan:8,className:"text-center py-4",children:"Loading..."})}):_.length===0?t("tr",{children:t("td",{colSpan:8,className:"text-center py-4 text-muted",children:"No users found"})}):_.map(e=>o("tr",{children:[t("td",{children:e.id}),t("td",{children:e.username}),t("td",{children:e.email}),t("td",{children:e.first_name||"-"}),t("td",{children:e.last_name||"-"}),t("td",{children:new Date(e.date_joined).toLocaleString()}),t("td",{children:t("button",{className:`btn btn-sm ${e.is_active?"btn-success":"btn-warning"}`,onClick:()=>E(e),children:e.is_active?"Active":"Inactive"})}),t("td",{children:t("button",{className:`btn btn-sm ${e.id<2?"btn-secondary opacity-50 cursor-not-allowed":"btn-danger"}`,onClick:()=>D(e),disabled:e.id<2,children:"Delete"})})]},e.id))})]})}),m>1&&o("div",{className:"flex justify-center mt-4 gap-1 flex-wrap",children:[t("button",{className:"btn btn-sm btn-outline-primary",disabled:l===1,onClick:()=>b(l-1),children:"Prev"}),Array.from({length:m},(e,n)=>n+1).map(e=>t("button",{className:`btn btn-sm ${l===e?"btn-primary":"btn-outline-primary"}`,onClick:()=>b(e),children:e},e)),t("button",{className:"btn btn-sm btn-outline-primary",disabled:l===m,onClick:()=>b(l+1),children:"Next"})]})]})};export{R as default};
